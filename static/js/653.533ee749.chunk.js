!function(){"use strict";var e={6653:function(e,t,r){var n=r(9439),o=r(7762),a=r(1413),i=r(5861),s=r(7757),c=r.n(s),l=r(5671),u=r(3144),f=r(6296),p=r(6420),d=r(608);function h(e){return v.apply(this,arguments)}function v(){return v=(0,d.Z)(c().mark((function e(t){var r,n,a,i,s,l,u,f,d,h,v,g,b,m,k,x,O=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=O.length>1&&void 0!==O[1]?O[1]:{},n=r.signal,a=/\r?\n/,i=new TextDecoder,s=!1,null===n||void 0===n||n.addEventListener("abort",(function(){s=!0})),l="",u=t.read();case 7:if(!s){e.next=11;break}return console.log("Aborting JSON line by line parsing"),e.abrupt("break",45);case 11:return e.next=13,(0,p.Z)(u);case 13:if(d=e.sent,h=d.done,v=d.value,!h){e.next=21;break}if(!(l.length>0)){e.next=20;break}return e.next=20,JSON.parse(l);case 20:return e.abrupt("return");case 21:g=i.decode(v,{stream:!0}),b=(l+=g).split(a),l=null!==(f=b.pop())&&void 0!==f?f:"",m=(0,o.Z)(b),e.prev=26,m.s();case 28:if((k=m.n()).done){e.next=34;break}return x=k.value,e.next=32,JSON.parse(x);case 32:e.next=28;break;case 34:e.next=39;break;case 36:e.prev=36,e.t0=e.catch(26),m.e(e.t0);case 39:return e.prev=39,m.f(),e.finish(39);case 42:u=t.read(),e.next=7;break;case 45:case"end":return e.stop()}}),e,null,[[26,36,39,42]])}))),v.apply(this,arguments)}function g(e){return b.apply(this,arguments)}function b(){return b=(0,d.Z)(c().mark((function e(t){var r,n,a,i,s,l,u,d,v,g,b,m,k,x,O,w,y,C,A,Z,L,R,S,M,_=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=_.length>1&&void 0!==_[1]?_[1]:{},n=r.batchSize,a=void 0===n?100:n,i=r.limit,s=r.onBatchDownloaded,l=r.abortController,u=Array.isArray(t)?t:[t],d=0,v=0,g=!1,l&&l.signal.addEventListener("abort",(function(){g=!0})),b=(0,o.Z)(u),e.prev=7,b.s();case 9:if((m=b.n()).done){e.next=71;break}return x=m.value,console.log("Fetching data: ".concat(x)),e.next=14,(0,p.Z)(fetch(x,{cache:"force-cache",signal:null===l||void 0===l?void 0:l.signal}));case 14:if(O=e.sent,w=null===(k=O.body)||void 0===k?void 0:k.getReader()){e.next=18;break}throw new Error("Unable to create reader");case 18:y=h(w),console.log("Created asyncIterator: url=".concat(x)),C=[],A=!1,Z=!1,e.prev=23,R=(0,f.Z)(y);case 25:return e.next=27,(0,p.Z)(R.next());case 27:if(!(A=!(S=e.sent).done)){e.next=49;break}if(M=S.value,!g){e.next=32;break}throw console.log("Aborting dataset loading: url=".concat(x)),new Error("Request aborted !");case 32:if(s&&v%100===0&&s(v),C.push(M),++v!==i){e.next=41;break}return console.log("Limit of ".concat(i," items reached, returning")),e.next=39,C;case 39:return y.return(),e.abrupt("return");case 41:if(C.length!==a){e.next=46;break}return console.log("Yielded batch #".concat(d++,", ").concat(d*a," total")),e.next=45,C;case 45:C=[];case 46:A=!1,e.next=25;break;case 49:e.next=55;break;case 51:e.prev=51,e.t0=e.catch(23),Z=!0,L=e.t0;case 55:if(e.prev=55,e.prev=56,!A||null==R.return){e.next=60;break}return e.next=60,(0,p.Z)(R.return());case 60:if(e.prev=60,!Z){e.next=63;break}throw L;case 63:return e.finish(60);case 64:return e.finish(55);case 65:return console.log("Yielded final batch #".concat(d,", ").concat(d*a+C.length," total")),s&&s(v),e.next=69,C;case 69:e.next=9;break;case 71:e.next=76;break;case 73:e.prev=73,e.t1=e.catch(7),b.e(e.t1);case 76:return e.prev=76,b.f(),e.finish(76);case 79:case"end":return e.stop()}}),e,null,[[7,73,76,79],[23,51,55,65],[56,,60,64]])}))),b.apply(this,arguments)}r(173);function m(e){return.3048*e}var k=function(){function e(){var t=this;(0,l.Z)(this,e),this.metadata=null,this.loadOptions=null,this.state={chunks:[],loading:!1,error:null},this.start=function(){var e=(0,i.Z)(c().mark((function e(r){var n,o,i,s,l,u,p,d,h,v,b,k,x,O,w,y,C,A,Z;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=r.metadata,i=r.loadOptions,s=r.abortController,l=r.onChunkLoaded,u=r.onProgress,p=s.signal,t.setState((function(e){return(0,a.Z)((0,a.Z)({},e),{},{loading:!0,error:null,chunks:[]})})),t.metadata=o,t.loadOptions=i,h={flights:0,downloadedFlights:0,drawnDataPoints:0,totalDataPoints:0,countByAo:d={}},v=g(o.url,{limit:null!==(n=i.hardLimit)&&void 0!==n?n:void 0,batchSize:i.batchSize,abortController:s,onBatchDownloaded:function(e){h.downloadedFlights=e,u(h)}}),b=i.sampleRate,k=0,x=!1,O=!1,e.prev=12,y=function(){var e=A.value;if(p.aborted)return"break";for(var r=0,n=0,o=[],i=0;i<e.length;i++){var s=e[i];s.aircraftOperator&&(d[s.aircraftOperator]||(d[s.aircraftOperator]=0),d[s.aircraftOperator]++);var c=Math.floor(s.timestampOffsets.length/b);s.timestampOffsets.length%b!==0&&c++,r+=c,o[i]=c,n+=s.timestampOffsets.length}var f=new Float32Array(3*r),v=new Float32Array(r),g=new Array(e.length).fill(null),x=new Uint32Array(e.length);x[0]=0;for(var O=0;O<e.length;O++){for(var w=e[O],y=w.coordinates.length,C=x[O],Z=0;Z<y;Z++){var L,R;if(Z%b===0){var S=w.coordinates[Z],M=m(S[2]);f[3*C]=S[0],f[3*C+1]=S[1],f[3*C+2]=M,v[C]=w.timestampOffsets[Z],g[C]=null!==(L=null===(R=w.squawks)||void 0===R?void 0:R[Z])&&void 0!==L?L:null,C++}}C-x[O]!==o[O]&&console.log("[WARNING] Flight ".concat(w.callsign,", computed ").concat(C-x[O]," positions, expected ").concat(o[O],", initial number of positions = ").concat(w.coordinates.length,", remainder = ").concat(w.coordinates.length%b)),O+1!==e.length&&(x[O+1]=C),delete w.coordinates,delete w.timestampOffsets}if(e.length>0){if(console.log("Creating new trajectoryChunk, with ".concat(x.length," flights")),p.aborted)return"continue";var _={rawItems:e,positions:f,timestampOffsets:v,startIndices:x,squawks:g};t.setState((function(t){return(0,a.Z)((0,a.Z)({},t),{},{chunks:t.chunks.concat([{rawItems:e,positions:f,timestampOffsets:v,startIndices:x,squawks:g}])})})),l(_,k),k++,h.flights+=e.length,h.drawnDataPoints+=r,h.totalDataPoints+=n,u(h)}},C=(0,f.Z)(v);case 15:return e.next=17,C.next();case 17:if(!(x=!(A=e.sent).done)){e.next=26;break}if("break"!==(Z=y())){e.next=21;break}return e.abrupt("break",26);case 21:if("continue"!==Z){e.next=23;break}return e.abrupt("continue",23);case 23:x=!1,e.next=15;break;case 26:e.next=32;break;case 28:e.prev=28,e.t0=e.catch(12),O=!0,w=e.t0;case 32:if(e.prev=32,e.prev=33,!x||null==C.return){e.next=37;break}return e.next=37,C.return();case 37:if(e.prev=37,!O){e.next=40;break}throw w;case 40:return e.finish(37);case 41:return e.finish(32);case 42:if(!p.aborted){e.next=44;break}return e.abrupt("return");case 44:t.setState((function(e){return(0,a.Z)((0,a.Z)({},e),{},{loading:!1})}));case 45:case"end":return e.stop()}}),e,null,[[12,28,32,42],[33,,37,41]])})));return function(t){return e.apply(this,arguments)}}()}return(0,u.Z)(e,[{key:"setState",value:function(e){var t=e(this.state);this.state=t}}]),e}(),x=r(3433),O=r(9330),w=r(4131),y=r(2810);O.Z.slice().map((function(e){var t=(0,w.tB)(e);return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t}(t.values[0],t.values[1],t.values[2])}));var C={id:(0,y.Z)(),type:"catchAll",enabled:!0,displayName:"All flights",color:[].concat((0,x.Z)([155,89,182]),[160])},A={id:(0,y.Z)(),type:"catchAll",enabled:!0,displayName:"Others",color:[102,102,102,8]};function Z(e){switch(e.type){case"catchAll":return function(){return!0};case"aircraftOperator":var t=new Set(e.aircraftOperators);return function(e){return!!e.aircraftOperator&&t.has(e.aircraftOperator)};case"callsign":var r=e.startsWith.toUpperCase().trim();return function(t){return!!t.callsign.startsWith(r)&&(!(null!=e.maxLength&&t.callsign.length>e.maxLength)&&!(null!=e.minLength&&t.callsign.length<e.minLength))};case"altitudeGradient":var n=e.topColor,o=e.bottomColor,a=e.topFt,i=e.bottomFt,s=e.excludeAbove,c=void 0!==s&&s,l=e.excludeBelow,u=void 0!==l&&l,f=m(a),p=m(i),d=n[0]===o[0]&&n[1]===o[1]&&n[2]===o[2]&&n[3]===o[3];return function(e){return function(e){var t=e.altitudeM;if(c&&t>f)return M;if(u&&t<p)return M;if(d)return t<=f&&t>=p?n:M;var r=R(null!==p&&void 0!==p?p:0,f,t);return[L(o[0],n[0],r),L(o[1],n[1],r),L(o[2],n[2],r),L(o[3],n[3],r)]}};case"airport":var h=e.airports.map((function(e){return e.toUpperCase().trim()}));return function(t){return h.some((function(r){var n,o;return!("departures"!==e.airportFilterMode&&"all"!==e.airportFilterMode||null===(n=t.departure)||void 0===n||!n.startsWith(r))||!("arrivals"!==e.airportFilterMode&&"all"!==e.airportFilterMode||null===(o=t.destination)||void 0===o||!o.startsWith(r))}))};default:return function(){return!1}}}var L=function(e,t,r){return e*(1-r)+t*r},R=function(e,t,r){return S((r-e)/(t-e))},S=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(r,Math.max(t,e))},M=[0,0,0,0],_=function(e){var t=(0,y.Z)();return"normal"===e?(0,a.Z)((0,a.Z)({},C),{},{id:t}):(0,a.Z)((0,a.Z)({},A),{},{id:t})}("normal");_.color=[255,0,0,255];var I=[0,0,0,0],D=function(){function e(){var t=this;(0,l.Z)(this,e),this.colorMatchers=[{filter:_,matcher:Z(_)}],this.computeColorChunk=function(e){var r=e.chunkIndex,n=e.chunk,o=performance.now();if(console.log("[ColorProcessor.computeColorCunk] Computing colors for chunk #".concat(r,", length=").concat(n.rawItems.length)),n){for(var a=n.timestampOffsets.length,i=new Uint8Array(4*a),s=n.startIndices,c=0;c<n.rawItems.length;c++)for(var l,u=n.rawItems[c],f=s[c],p=null!==(l=s[c+1])&&void 0!==l?l:a,d=t.getColorForItem(u),h=f;h<p;h++)if("function"===typeof d){var v=n.positions[3*h],g=d({latitude:n.positions[3*h+1],longitude:v,altitudeM:n.positions[3*h+2]});i[4*h]=g[0],i[4*h+1]=g[1],i[4*h+2]=g[2],i[4*h+3]=g[3]}else i[4*h]=d[0],i[4*h+1]=d[1],i[4*h+2]=d[2],i[4*h+3]=d[3];var b=performance.now()-o;return console.log("[ColorProcessor.computeColorChunk] Chunk #".concat(r," took ").concat(b,"ms")),i}console.warn("[ColorProcessor.computeColorCunk] Chunk #".concat(r," could not be found ?"))},this.setColorFilters=function(e){t.colorMatchers=e.map((function(e){return{filter:e,matcher:Z(e)}}))}}return(0,u.Z)(e,[{key:"getColorForItem",value:function(e){if(0===this.colorMatchers.length)return _.color;var t,r,n=[],a=(0,o.Z)(this.colorMatchers);try{for(a.s();!(r=a.n()).done;){var i=r.value,s=i.filter,c=i.matcher;if(s.enabled){var l=c(e);if("function"===typeof l&&n.push({filter:s,plotMatcher:l}),!0===c(e)){if(0===n.length)return s.color;t=s.color}}}}catch(u){a.e(u)}finally{a.f()}return n.length>0?function(e){var r,a,i=(0,o.Z)(n);try{for(i.s();!(a=i.n()).done;){var s=a.value,c=s.filter,l=(0,s.plotMatcher)(e);if(!1!==l)return!0===l?c.color:l}}catch(u){i.e(u)}finally{i.f()}return null!==(r=t)&&void 0!==r?r:I}:I}}]),e}();self.onmessage=function(e){return E.apply(this,arguments)};var F=new k,P=new D,T=new AbortController,N=new AbortController;function E(){return(E=(0,i.Z)(c().mark((function e(t){var r,i,s,l,u,f,p,d,h,v,g,b,m;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("[worker] Message received !",t),r=t.data,e.t0=r.type,e.next="LOAD_START"===e.t0?5:"LOAD_ABORT"===e.t0?24:"SET_COLOR_RULES"===e.t0?26:64;break;case 5:return T&&(T.abort(),T=new AbortController),N&&(N.abort(),N=new AbortController),console.log("[worker] Starting dataset load",r.metadata,r.loadOptions,self.location),i=r.metadata,s=r.loadOptions,U({type:"COLOR_START"}),U({type:"LOAD_START"}),e.prev=11,e.next=14,F.start({metadata:i,loadOptions:s,abortController:T,onChunkLoaded:function(e,t){var r=(0,a.Z)((0,a.Z)({},e),{},{positions:e.positions.slice(0),timestampOffsets:e.timestampOffsets.slice(0)});U({type:"LOAD_CHUNK",idx:t,chunk:r},[r.positions.buffer,r.timestampOffsets.buffer]);var n=P.computeColorChunk({chunk:e,chunkIndex:t});n&&U({type:"COLOR_CHUNK",chunkIndices:[t],colors:[n=n.slice()]},[n.buffer])},onProgress:function(e){U({type:"LOAD_PROGRESS",statistics:e})}});case 14:e.next=20;break;case 16:e.prev=16,e.t1=e.catch(11),U({type:"LOAD_ERROR",errorMessage:e.t1.message}),U({type:"COLOR_ERROR",errorMessage:e.t1.message});case 20:return console.log("[worker] Loading done !"),U({type:"LOAD_DONE"}),U({type:"COLOR_DONE"}),e.abrupt("return");case 24:return T&&(T.abort(),T=new AbortController),e.abrupt("return");case 26:N&&(console.log("[worker]: Aborting previous run"),N.abort(),N=new AbortController),l=N.signal,console.log("[worker]: Setting color filters"),P.setColorFilters(r.rules),U({type:"COLOR_START"}),u=[],f=performance.now(),p=1500,d=(0,o.Z)(F.state.chunks.entries()),e.prev=35,d.s();case 37:if((h=d.n()).done){e.next=53;break}if(v=(0,n.Z)(h.value,2),g=v[0],b=v[1],!l.aborted){e.next=43;break}return console.log("[worker]: Run aborted while not finished !"),N=new AbortController,e.abrupt("return");case 43:if(m=P.computeColorChunk({chunkIndex:g,chunk:b})){e.next=46;break}return e.abrupt("return");case 46:return u.push({idx:g,colors:m.slice()}),performance.now()-f>p&&(console.log("[worker]: elapsed > MAX_WAIT, flushing queue"),U({type:"COLOR_CHUNK",chunkIndices:u.map((function(e){return e.idx})),colors:u.map((function(e){return e.colors}))},u.map((function(e){return e.colors.buffer}))),u=[],f=performance.now()),e.next=51,j(0);case 51:e.next=37;break;case 53:e.next=58;break;case 55:e.prev=55,e.t2=e.catch(35),d.e(e.t2);case 58:return e.prev=58,d.f(),e.finish(58);case 61:return u.length&&U({type:"COLOR_CHUNK",chunkIndices:u.map((function(e){return e.idx})),colors:u.map((function(e){return e.colors}))},u.map((function(e){return e.colors.buffer}))),U({type:"COLOR_DONE"}),e.abrupt("return");case 64:console.log("[worker]: Unhandled message type ".concat(r.type));case 65:case"end":return e.stop()}}),e,null,[[11,16],[35,55,58,61]])})))).apply(this,arguments)}function U(e,t){t?self.postMessage(e,t):self.postMessage(e)}function j(e){return new Promise((function(t){return setTimeout(t,e)}))}}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}r.m=e,r.x=function(){var e=r.O(void 0,[531],(function(){return r(6653)}));return e=r.O(e)},r.amdO={},function(){var e=[];r.O=function(t,n,o,a){if(!n){var i=1/0;for(u=0;u<e.length;u++){n=e[u][0],o=e[u][1],a=e[u][2];for(var s=!0,c=0;c<n.length;c++)(!1&a||i>=a)&&Object.keys(r.O).every((function(e){return r.O[e](n[c])}))?n.splice(c--,1):(s=!1,a<i&&(i=a));if(s){e.splice(u--,1);var l=o();void 0!==l&&(t=l)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[n,o,a]}}(),r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=function(e){return Promise.all(Object.keys(r.f).reduce((function(t,n){return r.f[n](e,t),t}),[]))},r.u=function(e){return"static/js/"+e+".4c8f2c38.chunk.js"},r.miniCssF=function(e){},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="https://aboveourheads.github.io/",function(){var e={653:1};r.f.i=function(t,n){e[t]||importScripts(r.p+r.u(t))};var t=self.webpackChunkdatavis_test=self.webpackChunkdatavis_test||[],n=t.push.bind(t);t.push=function(t){var o=t[0],a=t[1],i=t[2];for(var s in a)r.o(a,s)&&(r.m[s]=a[s]);for(i&&i(r);o.length;)e[o.pop()]=1;n(t)}}(),function(){var e=r.x;r.x=function(){return r.e(531).then(e)}}();r.x()}();
//# sourceMappingURL=653.533ee749.chunk.js.map