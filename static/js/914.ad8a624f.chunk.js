!function(){"use strict";var e={3914:function(e,t,r){var n=r(9439),o=r(7762),a=r(5861),s=r(7757),i=r.n(s),c=r(1413),l=r(5671),u=r(3144),f=r(6296),p=r(6420),d=r(9632);function h(e){return v.apply(this,arguments)}function v(){return v=(0,d.Z)(i().mark((function e(t){var r,n,a,s,c,l,u,f,d,h,v,g,b,m,k,x=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=x.length>1&&void 0!==x[1]?x[1]:{},n=r.signal,a=/\r?\n/,s=new TextDecoder,c="",l=t.read();case 5:if(null===n||void 0===n||!n.aborted){e.next=9;break}return console.log("Aborting JSON line by line parsing"),e.abrupt("break",43);case 9:return e.next=11,(0,p.Z)(l);case 11:if(f=e.sent,d=f.done,h=f.value,!d){e.next=19;break}if(!(c.length>0)){e.next=18;break}return e.next=18,JSON.parse(c);case 18:return e.abrupt("return");case 19:v=s.decode(h,{stream:!0}),g=(c+=v).split(a),c=null!==(u=g.pop())&&void 0!==u?u:"",b=(0,o.Z)(g),e.prev=24,b.s();case 26:if((m=b.n()).done){e.next=32;break}return k=m.value,e.next=30,JSON.parse(k);case 30:e.next=26;break;case 32:e.next=37;break;case 34:e.prev=34,e.t0=e.catch(24),b.e(e.t0);case 37:return e.prev=37,b.f(),e.finish(37);case 40:l=t.read(),e.next=5;break;case 43:case"end":return e.stop()}}),e,null,[[24,34,37,40]])}))),v.apply(this,arguments)}function g(e){return b.apply(this,arguments)}function b(){return b=(0,d.Z)(i().mark((function e(t){var r,n,a,s,c,l,u,d,v,g,b,m,k,x,O,w,y,C,A,Z,R,S,L,M,_=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=_.length>1&&void 0!==_[1]?_[1]:{},n=r.batchSize,a=void 0===n?100:n,s=r.limit,c=r.onBatchDownloaded,l=r.abortController,u=Array.isArray(t)?t:[t],d=0,v=0,g=null===l||void 0===l?void 0:l.signal,b=(0,o.Z)(u),e.prev=6,b.s();case 8:if((m=b.n()).done){e.next=70;break}return x=m.value,console.log("Fetching data: ".concat(x)),e.next=13,(0,p.Z)(fetch(x,{cache:"force-cache",signal:null===l||void 0===l?void 0:l.signal}));case 13:if(O=e.sent,w=null===(k=O.body)||void 0===k?void 0:k.getReader()){e.next=17;break}throw new Error("Unable to create reader");case 17:y=h(w),console.log("Created asyncIterator: url=".concat(x)),C=[],A=!1,Z=!1,e.prev=22,S=(0,f.Z)(y);case 24:return e.next=26,(0,p.Z)(S.next());case 26:if(!(A=!(L=e.sent).done)){e.next=48;break}if(M=L.value,null===g||void 0===g||!g.aborted){e.next=31;break}throw console.log("Aborting dataset loading: url=".concat(x)),new Error("Request aborted !");case 31:if(c&&v%100===0&&c(v),C.push(M),++v!==s){e.next=40;break}return console.log("Limit of ".concat(s," items reached, returning")),e.next=38,C;case 38:return y.return(),e.abrupt("return");case 40:if(C.length!==a){e.next=45;break}return console.log("Yielded batch #".concat(d++,", ").concat(d*a," total")),e.next=44,C;case 44:C=[];case 45:A=!1,e.next=24;break;case 48:e.next=54;break;case 50:e.prev=50,e.t0=e.catch(22),Z=!0,R=e.t0;case 54:if(e.prev=54,e.prev=55,!A||null==S.return){e.next=59;break}return e.next=59,(0,p.Z)(S.return());case 59:if(e.prev=59,!Z){e.next=62;break}throw R;case 62:return e.finish(59);case 63:return e.finish(54);case 64:return console.log("Yielded final batch #".concat(d,", ").concat(d*a+C.length," total")),c&&c(v),e.next=68,C;case 68:e.next=8;break;case 70:e.next=75;break;case 72:e.prev=72,e.t1=e.catch(6),b.e(e.t1);case 75:return e.prev=75,b.f(),e.finish(75);case 78:case"end":return e.stop()}}),e,null,[[6,72,75,78],[22,50,54,64],[55,,59,63]])}))),b.apply(this,arguments)}r(173);function m(e){return.3048*e}var k=function(){function e(){var t=this;(0,l.Z)(this,e),this.metadata=null,this.loadOptions=null,this.state={chunks:[],loading:!1,error:null},this.start=function(){var e=(0,a.Z)(i().mark((function e(r){var n,o,a,s,l,u,p,d,h,v,b,k,x,O,w,y,C,A,Z;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=r.metadata,a=r.loadOptions,s=r.abortController,l=r.onChunkLoaded,u=r.onProgress,p=s.signal,t.setState((function(e){return(0,c.Z)((0,c.Z)({},e),{},{loading:!0,error:null,chunks:[]})})),t.metadata=o,t.loadOptions=a,h={flights:0,downloadedFlights:0,drawnDataPoints:0,totalDataPoints:0,countByAo:d={}},v=g(o.url,{limit:null!==(n=a.hardLimit)&&void 0!==n?n:void 0,batchSize:a.batchSize,abortController:s,onBatchDownloaded:function(e){h.downloadedFlights=e,u(h)}}),b=a.sampleRate,k=0,x=!1,O=!1,e.prev=12,y=function(){var e=A.value;if(p.aborted)return"break";for(var r=0,n=0,o=[],a=0;a<e.length;a++){var s=e[a];s.aircraftOperator&&(d[s.aircraftOperator]||(d[s.aircraftOperator]=0),d[s.aircraftOperator]++);var i=Math.floor(s.timestampOffsets.length/b);s.timestampOffsets.length%b!==0&&i++,r+=i,o[a]=i,n+=s.timestampOffsets.length}var f=new Float32Array(3*r),v=new Float32Array(r),g=new Array(e.length).fill(null),x=new Uint32Array(e.length);x[0]=0;for(var O=0;O<e.length;O++){for(var w=e[O],y=w.coordinates.length,C=x[O],Z=0;Z<y;Z++){var R,S;if(Z%b===0){var L=w.coordinates[Z],M=m(L[2]);f[3*C]=L[0],f[3*C+1]=L[1],f[3*C+2]=M,v[C]=w.timestampOffsets[Z],g[C]=null!==(R=null===(S=w.squawks)||void 0===S?void 0:S[Z])&&void 0!==R?R:null,C++}}C-x[O]!==o[O]&&console.log("[WARNING] Flight ".concat(w.callsign,", computed ").concat(C-x[O]," positions, expected ").concat(o[O],", initial number of positions = ").concat(w.coordinates.length,", remainder = ").concat(w.coordinates.length%b)),O+1!==e.length&&(x[O+1]=C),delete w.coordinates,delete w.timestampOffsets}if(e.length>0){if(console.log("Creating new trajectoryChunk, with ".concat(x.length," flights")),p.aborted)return"continue";var _={rawItems:e,positions:f,timestampOffsets:v,startIndices:x,squawks:g};t.setState((function(t){return(0,c.Z)((0,c.Z)({},t),{},{chunks:t.chunks.concat([{rawItems:e,positions:f,timestampOffsets:v,startIndices:x,squawks:g}])})})),l(_,k),k++,h.flights+=e.length,h.drawnDataPoints+=r,h.totalDataPoints+=n,u(h)}},C=(0,f.Z)(v);case 15:return e.next=17,C.next();case 17:if(!(x=!(A=e.sent).done)){e.next=26;break}if("break"!==(Z=y())){e.next=21;break}return e.abrupt("break",26);case 21:if("continue"!==Z){e.next=23;break}return e.abrupt("continue",23);case 23:x=!1,e.next=15;break;case 26:e.next=32;break;case 28:e.prev=28,e.t0=e.catch(12),O=!0,w=e.t0;case 32:if(e.prev=32,e.prev=33,!x||null==C.return){e.next=37;break}return e.next=37,C.return();case 37:if(e.prev=37,!O){e.next=40;break}throw w;case 40:return e.finish(37);case 41:return e.finish(32);case 42:if(!p.aborted){e.next=44;break}return e.abrupt("return");case 44:t.setState((function(e){return(0,c.Z)((0,c.Z)({},e),{},{loading:!1})}));case 45:case"end":return e.stop()}}),e,null,[[12,28,32,42],[33,,37,41]])})));return function(t){return e.apply(this,arguments)}}()}return(0,u.Z)(e,[{key:"setState",value:function(e){var t=e(this.state);this.state=t}}]),e}(),x=r(3433),O=r(9330),w=r(4131),y=r(9575);O.Z.slice().map((function(e){var t=(0,w.tB)(e);return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t}(t.values[0],t.values[1],t.values[2])}));var C={id:(0,y.Z)(),type:"catchAll",enabled:!0,displayName:"All flights",color:[].concat((0,x.Z)([155,89,182]),[160])},A={id:(0,y.Z)(),type:"catchAll",enabled:!0,displayName:"Others",color:[102,102,102,8]};function Z(e){switch(e.type){case"catchAll":return function(){return!0};case"aircraftOperator":var t=new Set(e.aircraftOperators);return function(e){return!!e.aircraftOperator&&t.has(e.aircraftOperator)};case"callsign":var r=e.startsWith.toUpperCase().trim();return function(t){return!!t.callsign.startsWith(r)&&(!(null!=e.maxLength&&t.callsign.length>e.maxLength)&&!(null!=e.minLength&&t.callsign.length<e.minLength))};case"altitudeGradient":var n=e.topColor,o=e.bottomColor,a=e.topFt,s=e.bottomFt,i=e.excludeAbove,c=void 0!==i&&i,l=e.excludeBelow,u=void 0!==l&&l,f=m(a),p=m(s),d=n[0]===o[0]&&n[1]===o[1]&&n[2]===o[2]&&n[3]===o[3];return function(e){return function(e){var t=e.altitudeM;if(c&&t>f)return M;if(u&&t<p)return M;if(d)return t<=f&&t>=p?n:M;var r=S(null!==p&&void 0!==p?p:0,f,t);return[R(o[0],n[0],r),R(o[1],n[1],r),R(o[2],n[2],r),R(o[3],n[3],r)]}};case"airport":var h=e.airports.map((function(e){return e.toUpperCase().trim()}));return function(t){return h.some((function(r){var n,o;return!("departures"!==e.airportFilterMode&&"all"!==e.airportFilterMode||null===(n=t.departure)||void 0===n||!n.startsWith(r))||!("arrivals"!==e.airportFilterMode&&"all"!==e.airportFilterMode||null===(o=t.destination)||void 0===o||!o.startsWith(r))}))};default:return function(){return!1}}}var R=function(e,t,r){return e*(1-r)+t*r},S=function(e,t,r){return L((r-e)/(t-e))},L=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(r,Math.max(t,e))},M=[0,0,0,0],_=function(e){var t=(0,y.Z)();return"normal"===e?(0,c.Z)((0,c.Z)({},C),{},{id:t}):(0,c.Z)((0,c.Z)({},A),{},{id:t})}("normal");_.color=[255,0,0,255];var I=[0,0,0,0],D=function(){function e(){var t=this;(0,l.Z)(this,e),this.colorMatchers=[{filter:_,matcher:Z(_)}],this.computeColorChunk=function(e){var r=e.chunkIndex,n=e.chunk,o=performance.now();if(console.log("[ColorProcessor.computeColorCunk] Computing colors for chunk #".concat(r,", length=").concat(n.rawItems.length)),n){for(var a=n.timestampOffsets.length,s=new Uint8Array(4*a),i=n.startIndices,c=0;c<n.rawItems.length;c++)for(var l,u=n.rawItems[c],f=i[c],p=null!==(l=i[c+1])&&void 0!==l?l:a,d=t.getColorForItem(u),h=f;h<p;h++)if("function"===typeof d){var v=n.positions[3*h],g=d({latitude:n.positions[3*h+1],longitude:v,altitudeM:n.positions[3*h+2]});s[4*h]=g[0],s[4*h+1]=g[1],s[4*h+2]=g[2],s[4*h+3]=g[3]}else s[4*h]=d[0],s[4*h+1]=d[1],s[4*h+2]=d[2],s[4*h+3]=d[3];var b=performance.now()-o;return console.log("[ColorProcessor.computeColorChunk] Chunk #".concat(r," took ").concat(b,"ms")),s}console.warn("[ColorProcessor.computeColorCunk] Chunk #".concat(r," could not be found ?"))},this.setColorFilters=function(e){t.colorMatchers=e.map((function(e){return{filter:e,matcher:Z(e)}}))}}return(0,u.Z)(e,[{key:"getColorForItem",value:function(e){if(0===this.colorMatchers.length)return _.color;var t,r,n=[],a=(0,o.Z)(this.colorMatchers);try{for(a.s();!(r=a.n()).done;){var s=r.value,i=s.filter,c=s.matcher;if(i.enabled){var l=c(e);if("function"===typeof l&&n.push({filter:i,plotMatcher:l}),!0===c(e)){if(0===n.length)return i.color;t=i.color}}}}catch(u){a.e(u)}finally{a.f()}return n.length>0?function(e){var r,a,s=(0,o.Z)(n);try{for(s.s();!(a=s.n()).done;){var i=a.value,c=i.filter,l=(0,i.plotMatcher)(e);if(!1!==l)return!0===l?c.color:l}}catch(u){s.e(u)}finally{s.f()}return null!==(r=t)&&void 0!==r?r:I}:I}}]),e}();self.onmessage=function(e){return U.apply(this,arguments)};var F=new k,P=new D,T=new AbortController,N=new AbortController;function U(){return(U=(0,a.Z)(i().mark((function e(t){var r,a,s,c,l,u,f,p,d,h,v,g,b;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("[worker] Message received !",t),r=t.data,e.t0=r.type,e.next="LOAD_START"===e.t0?5:"LOAD_ABORT"===e.t0?24:"SET_COLOR_RULES"===e.t0?26:64;break;case 5:return T&&(T.abort(),T=new AbortController),N&&(N.abort(),N=new AbortController),console.log("[worker] Starting dataset load",r.metadata,r.loadOptions,self.location),a=r.metadata,s=r.loadOptions,E({type:"COLOR_START"}),E({type:"LOAD_START"}),e.prev=11,e.next=14,F.start({metadata:a,loadOptions:s,abortController:T,onChunkLoaded:function(e,t){var r={startIndices:e.startIndices,positions:e.positions.slice(0),timestampOffsets:e.timestampOffsets.slice(0)};E({type:"LOAD_CHUNK",idx:t,chunk:r},[r.positions.buffer,r.timestampOffsets.buffer]);var n=P.computeColorChunk({chunk:e,chunkIndex:t});n&&E({type:"COLOR_CHUNK",chunkIndices:[t],colors:[n=n.slice()]},[n.buffer])},onProgress:function(e){E({type:"LOAD_PROGRESS",statistics:e})}});case 14:e.next=20;break;case 16:e.prev=16,e.t1=e.catch(11),E({type:"LOAD_ERROR",errorMessage:e.t1.message}),E({type:"COLOR_ERROR",errorMessage:e.t1.message});case 20:return console.log("[worker] Loading done !"),E({type:"LOAD_DONE"}),E({type:"COLOR_DONE"}),e.abrupt("return");case 24:return T&&(T.abort(),T=new AbortController),e.abrupt("return");case 26:N&&(console.log("[worker]: Aborting previous run"),N.abort(),N=new AbortController),c=N.signal,console.log("[worker]: Setting color filters"),P.setColorFilters(r.rules),E({type:"COLOR_START"}),l=[],u=performance.now(),f=1500,p=(0,o.Z)(F.state.chunks.entries()),e.prev=35,p.s();case 37:if((d=p.n()).done){e.next=53;break}if(h=(0,n.Z)(d.value,2),v=h[0],g=h[1],!c.aborted){e.next=43;break}return console.log("[worker]: Run aborted while not finished !"),N=new AbortController,e.abrupt("return");case 43:if(b=P.computeColorChunk({chunkIndex:v,chunk:g})){e.next=46;break}return e.abrupt("return");case 46:return l.push({idx:v,colors:b.slice()}),performance.now()-u>f&&(console.log("[worker]: elapsed > MAX_WAIT, flushing queue"),E({type:"COLOR_CHUNK",chunkIndices:l.map((function(e){return e.idx})),colors:l.map((function(e){return e.colors}))},l.map((function(e){return e.colors.buffer}))),l=[],u=performance.now()),e.next=51,j(0);case 51:e.next=37;break;case 53:e.next=58;break;case 55:e.prev=55,e.t2=e.catch(35),p.e(e.t2);case 58:return e.prev=58,p.f(),e.finish(58);case 61:return l.length&&E({type:"COLOR_CHUNK",chunkIndices:l.map((function(e){return e.idx})),colors:l.map((function(e){return e.colors}))},l.map((function(e){return e.colors.buffer}))),E({type:"COLOR_DONE"}),e.abrupt("return");case 64:console.log("[worker]: Unhandled message type ".concat(r.type));case 65:case"end":return e.stop()}}),e,null,[[11,16],[35,55,58,61]])})))).apply(this,arguments)}function E(e,t){t?self.postMessage(e,t):self.postMessage(e)}function j(e){return new Promise((function(t){return setTimeout(t,e)}))}}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}r.m=e,r.x=function(){var e=r.O(void 0,[369],(function(){return r(3914)}));return e=r.O(e)},r.amdO={},function(){var e=[];r.O=function(t,n,o,a){if(!n){var s=1/0;for(u=0;u<e.length;u++){n=e[u][0],o=e[u][1],a=e[u][2];for(var i=!0,c=0;c<n.length;c++)(!1&a||s>=a)&&Object.keys(r.O).every((function(e){return r.O[e](n[c])}))?n.splice(c--,1):(i=!1,a<s&&(s=a));if(i){e.splice(u--,1);var l=o();void 0!==l&&(t=l)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[n,o,a]}}(),r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=function(e){return Promise.all(Object.keys(r.f).reduce((function(t,n){return r.f[n](e,t),t}),[]))},r.u=function(e){return"static/js/"+e+".d81e910d.chunk.js"},r.miniCssF=function(e){},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="https://aboveourheads.github.io/",function(){var e={914:1};r.f.i=function(t,n){e[t]||importScripts(r.p+r.u(t))};var t=self.webpackChunkdatavis_test=self.webpackChunkdatavis_test||[],n=t.push.bind(t);t.push=function(t){var o=t[0],a=t[1],s=t[2];for(var i in a)r.o(a,i)&&(r.m[i]=a[i]);for(s&&s(r);o.length;)e[o.pop()]=1;n(t)}}(),function(){var e=r.x;r.x=function(){return r.e(369).then(e)}}();r.x()}();
//# sourceMappingURL=914.ad8a624f.chunk.js.map