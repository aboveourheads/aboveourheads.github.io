!function(){"use strict";var e={6653:function(e,t,r){var n=r(9439),a=r(7762),o=r(1413),s=r(5861),i=r(7757),c=r.n(i),u=r(5671),l=r(3144),f=r(6296),p=r(6420),d=r(9632);function h(e){return v.apply(this,arguments)}function v(){return v=(0,d.Z)(c().mark((function e(t){var r,n,o,s,i,u,l,f,d,h,v,g,b,m,k,O,x=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=x.length>1&&void 0!==x[1]?x[1]:{},n=r.signal,o=/\r?\n/,s=new TextDecoder,i=!1,null===n||void 0===n||n.addEventListener("abort",(function(){i=!0})),u="",l=t.read();case 7:if(!i){e.next=11;break}return console.log("Aborting JSON line by line parsing"),e.abrupt("break",45);case 11:return e.next=13,(0,p.Z)(l);case 13:if(d=e.sent,h=d.done,v=d.value,!h){e.next=21;break}if(!(u.length>0)){e.next=20;break}return e.next=20,JSON.parse(u);case 20:return e.abrupt("return");case 21:g=s.decode(v,{stream:!0}),b=(u+=g).split(o),u=null!==(f=b.pop())&&void 0!==f?f:"",m=(0,a.Z)(b),e.prev=26,m.s();case 28:if((k=m.n()).done){e.next=34;break}return O=k.value,e.next=32,JSON.parse(O);case 32:e.next=28;break;case 34:e.next=39;break;case 36:e.prev=36,e.t0=e.catch(26),m.e(e.t0);case 39:return e.prev=39,m.f(),e.finish(39);case 42:l=t.read(),e.next=7;break;case 45:case"end":return e.stop()}}),e,null,[[26,36,39,42]])}))),v.apply(this,arguments)}function g(e){return b.apply(this,arguments)}function b(){return b=(0,d.Z)(c().mark((function e(t){var r,n,o,s,i,u,l,d,v,g,b,m,k,O,x,y,w,C,Z,A,L,M,R,S,_=arguments;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=_.length>1&&void 0!==_[1]?_[1]:{},n=r.batchSize,o=void 0===n?100:n,s=r.limit,i=r.onBatchDownloaded,u=r.abortController,l=Array.isArray(t)?t:[t],d=0,v=0,g=!1,u&&u.signal.addEventListener("abort",(function(){g=!0})),b=(0,a.Z)(l),e.prev=7,b.s();case 9:if((m=b.n()).done){e.next=71;break}return O=m.value,console.log("Fetching data: ".concat(O)),e.next=14,(0,p.Z)(fetch(O,{cache:"force-cache",signal:null===u||void 0===u?void 0:u.signal}));case 14:if(x=e.sent,y=null===(k=x.body)||void 0===k?void 0:k.getReader()){e.next=18;break}throw new Error("Unable to create reader");case 18:w=h(y),console.log("Created asyncIterator: url=".concat(O)),C=[],Z=!1,A=!1,e.prev=23,M=(0,f.Z)(w);case 25:return e.next=27,(0,p.Z)(M.next());case 27:if(!(Z=!(R=e.sent).done)){e.next=49;break}if(S=R.value,!g){e.next=32;break}throw console.log("Aborting dataset loading: url=".concat(O)),new Error("Request aborted !");case 32:if(i&&v%100===0&&i(v),C.push(S),++v!==s){e.next=41;break}return console.log("Limit of ".concat(s," items reached, returning")),e.next=39,C;case 39:return w.return(),e.abrupt("return");case 41:if(C.length!==o){e.next=46;break}return console.log("Yielded batch #".concat(d++,", ").concat(d*o," total")),e.next=45,C;case 45:C=[];case 46:Z=!1,e.next=25;break;case 49:e.next=55;break;case 51:e.prev=51,e.t0=e.catch(23),A=!0,L=e.t0;case 55:if(e.prev=55,e.prev=56,!Z||null==M.return){e.next=60;break}return e.next=60,(0,p.Z)(M.return());case 60:if(e.prev=60,!A){e.next=63;break}throw L;case 63:return e.finish(60);case 64:return e.finish(55);case 65:return console.log("Yielded final batch #".concat(d,", ").concat(d*o+C.length," total")),i&&i(v),e.next=69,C;case 69:e.next=9;break;case 71:e.next=76;break;case 73:e.prev=73,e.t1=e.catch(7),b.e(e.t1);case 76:return e.prev=76,b.f(),e.finish(76);case 79:case"end":return e.stop()}}),e,null,[[7,73,76,79],[23,51,55,65],[56,,60,64]])}))),b.apply(this,arguments)}r(173);function m(e){return.3048*e}var k=function(){function e(){var t=this;(0,u.Z)(this,e),this.metadata=null,this.loadOptions=null,this.state={chunks:[],loading:!1,error:null},this.start=function(){var e=(0,s.Z)(c().mark((function e(r){var n,a,s,i,u,l,p,d,h,v,b,k,O,x,y,w,C,Z,A;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=r.metadata,s=r.loadOptions,i=r.abortController,u=r.onChunkLoaded,l=r.onProgress,p=i.signal,t.setState((function(e){return(0,o.Z)((0,o.Z)({},e),{},{loading:!0,error:null,chunks:[]})})),t.metadata=a,t.loadOptions=s,h={flights:0,downloadedFlights:0,drawnDataPoints:0,totalDataPoints:0,countByAo:d={}},v=g(a.url,{limit:null!==(n=s.hardLimit)&&void 0!==n?n:void 0,batchSize:s.batchSize,abortController:i,onBatchDownloaded:function(e){h.downloadedFlights=e,l(h)}}),b=s.sampleRate,k=0,O=!1,x=!1,e.prev=12,w=function(){var e=Z.value;if(p.aborted)return"break";for(var r=0,n=0,a=[],s=0;s<e.length;s++){var i=e[s];i.aircraftOperator&&(d[i.aircraftOperator]||(d[i.aircraftOperator]=0),d[i.aircraftOperator]++);var c=Math.floor(i.timestampOffsets.length/b);i.timestampOffsets.length%b!==0&&c++,r+=c,a[s]=c,n+=i.timestampOffsets.length}var f=new Float32Array(3*r),v=new Float32Array(r),g=new Array(e.length).fill(null),O=new Uint32Array(e.length);O[0]=0;for(var x=0;x<e.length;x++){for(var y=e[x],w=y.coordinates.length,C=O[x],A=0;A<w;A++){var L,M;if(A%b===0){var R=y.coordinates[A],S=m(R[2]);f[3*C]=R[0],f[3*C+1]=R[1],f[3*C+2]=S,v[C]=y.timestampOffsets[A],g[C]=null!==(L=null===(M=y.squawks)||void 0===M?void 0:M[A])&&void 0!==L?L:null,C++}}C-O[x]!==a[x]&&console.log("[WARNING] Flight ".concat(y.callsign,", computed ").concat(C-O[x]," positions, expected ").concat(a[x],", initial number of positions = ").concat(y.coordinates.length,", remainder = ").concat(y.coordinates.length%b)),x+1!==e.length&&(O[x+1]=C),delete y.coordinates,delete y.timestampOffsets}if(e.length>0){if(console.log("Creating new trajectoryChunk, with ".concat(O.length," flights")),p.aborted)return"continue";var _={rawItems:e,positions:f,timestampOffsets:v,startIndices:O,squawks:g};t.setState((function(t){return(0,o.Z)((0,o.Z)({},t),{},{chunks:t.chunks.concat([{rawItems:e,positions:f,timestampOffsets:v,startIndices:O,squawks:g}])})})),u(_,k),k++,h.flights+=e.length,h.drawnDataPoints+=r,h.totalDataPoints+=n,l(h)}},C=(0,f.Z)(v);case 15:return e.next=17,C.next();case 17:if(!(O=!(Z=e.sent).done)){e.next=26;break}if("break"!==(A=w())){e.next=21;break}return e.abrupt("break",26);case 21:if("continue"!==A){e.next=23;break}return e.abrupt("continue",23);case 23:O=!1,e.next=15;break;case 26:e.next=32;break;case 28:e.prev=28,e.t0=e.catch(12),x=!0,y=e.t0;case 32:if(e.prev=32,e.prev=33,!O||null==C.return){e.next=37;break}return e.next=37,C.return();case 37:if(e.prev=37,!x){e.next=40;break}throw y;case 40:return e.finish(37);case 41:return e.finish(32);case 42:if(!p.aborted){e.next=44;break}return e.abrupt("return");case 44:t.setState((function(e){return(0,o.Z)((0,o.Z)({},e),{},{loading:!1})}));case 45:case"end":return e.stop()}}),e,null,[[12,28,32,42],[33,,37,41]])})));return function(t){return e.apply(this,arguments)}}()}return(0,l.Z)(e,[{key:"setState",value:function(e){var t=e(this.state);this.state=t}}]),e}(),O=r(9062),x=r(9330),y=r(4131),w=r(9575);x.Z.slice().map((function(e){var t=(0,y.tB)(e);return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t}(t.values[0],t.values[1],t.values[2])}));var C={id:(0,w.Z)(),type:"catchAll",enabled:!0,displayName:"All flights",color:[].concat((0,O.Z)([155,89,182]),[160])},Z={id:(0,w.Z)(),type:"catchAll",enabled:!0,displayName:"Others",color:[102,102,102,8]};function A(e){switch(e.type){case"catchAll":return function(){return!0};case"aircraftOperator":var t=new Set(e.aircraftOperators);return function(e){return!!e.aircraftOperator&&t.has(e.aircraftOperator)};case"callsign":var r=e.startsWith.toUpperCase().trim();return function(t){return!!t.callsign.startsWith(r)&&(!(null!=e.maxLength&&t.callsign.length>e.maxLength)&&!(null!=e.minLength&&t.callsign.length<e.minLength))};case"altitudeGradient":var a=e.topColor,o=e.bottomColor,s=e.topM,i=e.bottomM,c=void 0===i?0:i;return function(e){return function(e){var t=e.altitudeM,r=M(c,s,t);return[L(o[0],a[0],r),L(o[1],a[1],r),L(o[2],a[2],r),L(o[3],a[3],r)]}};case"altitudeRange":var u=(0,n.Z)(e.rangeM,2),l=u[0],f=u[1];return function(){return function(e){var t=e.altitudeM;return t<=(null!==f&&void 0!==f?f:1/0)&&t>=(null!==l&&void 0!==l?l:-1/0)}};case"airport":var p=e.airports.map((function(e){return e.toUpperCase().trim()}));return function(t){return p.some((function(r){var n,a;return!("departures"!==e.airportFilterMode&&"all"!==e.airportFilterMode||null===(n=t.departure)||void 0===n||!n.startsWith(r))||!("arrivals"!==e.airportFilterMode&&"all"!==e.airportFilterMode||null===(a=t.destination)||void 0===a||!a.startsWith(r))}))};default:return function(){return!1}}}var L=function(e,t,r){return e*(1-r)+t*r},M=function(e,t,r){return R((r-e)/(t-e))},R=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(r,Math.max(t,e))};var S=function(e){var t=(0,w.Z)();return"normal"===e?(0,o.Z)((0,o.Z)({},C),{},{id:t}):(0,o.Z)((0,o.Z)({},Z),{},{id:t})}("normal");S.color=[255,0,0,255];var _=[0,0,0,0],D=function(){function e(){var t=this;(0,u.Z)(this,e),this.colorMatchers=[{filter:S,matcher:A(S)}],this.computeColorChunk=function(e){var r=e.chunkIndex,n=e.chunk,a=performance.now();if(console.log("[ColorProcessor.computeColorCunk] Computing colors for chunk #".concat(r,", length=").concat(n.rawItems.length)),n){for(var o=n.timestampOffsets.length,s=new Uint8Array(4*o),i=n.startIndices,c=0;c<n.rawItems.length;c++)for(var u,l=n.rawItems[c],f=i[c],p=null!==(u=i[c+1])&&void 0!==u?u:o,d=t.getColorForItem(l),h=f;h<p;h++)if("function"===typeof d){var v=n.positions[3*h],g=d({latitude:n.positions[3*h+1],longitude:v,altitudeM:n.positions[3*h+2]});s[4*h]=g[0],s[4*h+1]=g[1],s[4*h+2]=g[2],s[4*h+3]=g[3]}else s[4*h]=d[0],s[4*h+1]=d[1],s[4*h+2]=d[2],s[4*h+3]=d[3];var b=performance.now()-a;return console.log("[ColorProcessor.computeColorChunk] Chunk #".concat(r," took ").concat(b,"ms")),s}console.warn("[ColorProcessor.computeColorCunk] Chunk #".concat(r," could not be found ?"))},this.setColorFilters=function(e){t.colorMatchers=e.map((function(e){return{filter:e,matcher:A(e)}}))}}return(0,l.Z)(e,[{key:"getColorForItem",value:function(e){if(0===this.colorMatchers.length)return S.color;var t,r,n=[],o=(0,a.Z)(this.colorMatchers);try{for(o.s();!(r=o.n()).done;){var s=r.value,i=s.filter,c=s.matcher;if(i.enabled){var u=c(e);if("function"===typeof u&&n.push({filter:i,plotMatcher:u}),!0===c(e)){if(0===n.length)return i.color;t=i.color}}}}catch(l){o.e(l)}finally{o.f()}return n.length>0?function(e){var r,o,s=(0,a.Z)(n);try{for(s.s();!(o=s.n()).done;){var i=o.value,c=i.filter,u=(0,i.plotMatcher)(e);if(!1!==u)return!0===u?c.color:u}}catch(l){s.e(l)}finally{s.f()}return null!==(r=t)&&void 0!==r?r:_}:_}}]),e}();self.onmessage=function(e){return N.apply(this,arguments)};var I=new k,F=new D,P=new AbortController;function N(){return(N=(0,s.Z)(c().mark((function e(t){var r,s,i,u,l,f,p,d,h,v;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("[worker] Message received !",t),r=t.data,e.t0=r.type,e.next="LOAD_START"===e.t0?5:"LOAD_ABORT"===e.t0?23:"SET_COLOR_RULES"===e.t0?25:51;break;case 5:return P&&(P.abort(),P=new AbortController),console.log("[worker] Starting dataset load",r.metadata,r.loadOptions,self.location),s=r.metadata,i=r.loadOptions,T({type:"COLOR_START"}),T({type:"LOAD_START"}),e.prev=10,e.next=13,I.start({metadata:s,loadOptions:i,abortController:P,onChunkLoaded:function(e,t){var r=(0,o.Z)((0,o.Z)({},e),{},{positions:e.positions.slice(0),timestampOffsets:e.timestampOffsets.slice(0)});T({type:"LOAD_CHUNK",idx:t,chunk:r},[r.positions.buffer,r.timestampOffsets.buffer]);var n=F.computeColorChunk({chunk:e,chunkIndex:t});n&&T({type:"COLOR_CHUNK",chunkIndices:[t],colors:[n=n.slice()]},[n.buffer])},onProgress:function(e){T({type:"LOAD_PROGRESS",statistics:e})}});case 13:e.next=19;break;case 15:e.prev=15,e.t1=e.catch(10),T({type:"LOAD_ERROR",errorMessage:e.t1.message}),T({type:"COLOR_ERROR",errorMessage:e.t1.message});case 19:return console.log("[worker] Loading done !"),T({type:"LOAD_DONE"}),T({type:"COLOR_DONE"}),e.abrupt("return");case 23:return P&&(P.abort(),P=new AbortController),e.abrupt("return");case 25:console.log("[worker]: Setting color filters"),F.setColorFilters(r.rules),T({type:"COLOR_START"}),u=[],l=(0,a.Z)(I.state.chunks.entries()),e.prev=30,l.s();case 32:if((f=l.n()).done){e.next=40;break}if(p=(0,n.Z)(f.value,2),d=p[0],h=p[1],v=F.computeColorChunk({chunkIndex:d,chunk:h})){e.next=37;break}return e.abrupt("return");case 37:u.push({idx:d,colors:v.slice()});case 38:e.next=32;break;case 40:e.next=45;break;case 42:e.prev=42,e.t2=e.catch(30),l.e(e.t2);case 45:return e.prev=45,l.f(),e.finish(45);case 48:return T({type:"COLOR_CHUNK",chunkIndices:u.map((function(e){return e.idx})),colors:u.map((function(e){return e.colors}))},u.map((function(e){return e.colors.buffer}))),T({type:"COLOR_DONE"}),e.abrupt("return");case 51:console.log("[worker]: Unhandled message type ".concat(r.type));case 52:case"end":return e.stop()}}),e,null,[[10,15],[30,42,45,48]])})))).apply(this,arguments)}function T(e,t){t?self.postMessage(e,t):self.postMessage(e)}}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports}r.m=e,r.x=function(){var e=r.O(void 0,[608],(function(){return r(6653)}));return e=r.O(e)},r.amdO={},function(){var e=[];r.O=function(t,n,a,o){if(!n){var s=1/0;for(l=0;l<e.length;l++){n=e[l][0],a=e[l][1],o=e[l][2];for(var i=!0,c=0;c<n.length;c++)(!1&o||s>=o)&&Object.keys(r.O).every((function(e){return r.O[e](n[c])}))?n.splice(c--,1):(i=!1,o<s&&(s=o));if(i){e.splice(l--,1);var u=a();void 0!==u&&(t=u)}}return t}o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[n,a,o]}}(),r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=function(e){return Promise.all(Object.keys(r.f).reduce((function(t,n){return r.f[n](e,t),t}),[]))},r.u=function(e){return"static/js/"+e+".116da24c.chunk.js"},r.miniCssF=function(e){},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="https://aboveourheads.github.io/",function(){var e={653:1};r.f.i=function(t,n){e[t]||importScripts(r.p+r.u(t))};var t=self.webpackChunkdatavis_test=self.webpackChunkdatavis_test||[],n=t.push.bind(t);t.push=function(t){var a=t[0],o=t[1],s=t[2];for(var i in o)r.o(o,i)&&(r.m[i]=o[i]);for(s&&s(r);a.length;)e[a.pop()]=1;n(t)}}(),function(){var e=r.x;r.x=function(){return r.e(608).then(e)}}();r.x()}();
//# sourceMappingURL=653.db2d78c7.chunk.js.map